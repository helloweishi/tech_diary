title: How payment gateway work
link: http://tinyhack.com/2017/09/05/mastercard-internet-gateway-service-hashing-design-flaw/
tag: payment gateway
status: done
summary:
What is MIGS?
When you pay on a website, the website owner usually just connects their system to
an intermediate payment gateway (you will be forwarded to another website). 
This payment gateway then connects to several payments system available in a country. 
For credit card payment, many gateways will connect to another gateway (one of them is MIGS)
which works with many banks to provide 3DSecure service.

How does it work?
The payment flow is usually like this if you use MIGS:

1, You select items from an online store (merchant)
2, You enter your credit card number on the website
3, The card number, amount, etc is then signed and returned to
   the browser which will auto POST to intermediate payment gateway
4, The intermediate payment gateway will convert the format to the one 
    requested by MIGS, sign it (with MIGS key), and return it to the browser.
    Again this will auto POST, this time to MIGS server.
5, If 3D secure not requested, then go to step 6. If 3D secure is requested, 
    MIGS will redirect the request to the bank that issues the card, the bank 
    will ask for an OTP, and then it will generate HTML that will auto POST data to MIGS
6, MIGS will return a signed data to the browser, and will auto POST the data back to the intermediate Gateway
7, Intermediate Gateway will check if the data is valid or not based on the signature. 
   If it is not valid, then error page will be generated
8, Based on MIGS response, payment gateway will forward the status to the merchant

Notice that instead of communicating directly between servers, communications are done 
via userâ€™s browser, but everything is signed. In theory, if the signing process and 
verification process is correct then everything will be fine. Unfortunately, this is not always the case.
